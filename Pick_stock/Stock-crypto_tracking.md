# 选币/选股 + 调研 + 跟踪：完整版方案（机构化流程 · 可直接落地）

> 目标：在 **Crypto / 中国A股 / 美股** 多市场下，建立一套“选标的（Universe）→ 研究（Research）→ 跟踪监控（Tracking/ModelOps）→ 评估可用性（Backtest）”的完整工作流，且全流程可复现、可版本化。

---

## 0. 总体目标与基本原则

### 0.1 你要解决的核心问题
构建一个系统，能够：
- 选择一组“值得建模”的币/股票（可交易、数据好、可解释）
- 对每个标的做可复现研究：特征 → 标签 → 模型 → walk-forward 评估
- 持续跟踪：数据质量、模型表现、预测稳定性（可选：轻量回测检验边际价值）

### 0.2 时区规则（你指定的市场惯例，必须工程落地）
- **Crypto：北京时间（Asia/Shanghai）**
- **中国A股：北京时间（Asia/Shanghai）**
- **美股：美东时间（America/New_York）**

工程建议（避免 DST/跨时区坑）：
- **存储层**保留 `timestamp_utc`
- **展示层/UI**生成 `timestamp_market`（按上面市场时区转换）
- Dashboard 必须明确标注时区

---

## 1. Universe（标的池）怎么建：先“可交易/可建模”，再“好不好做”

建议将 Universe 做成独立模块：**Universe Builder**。输出不只是“我想做哪些”，而是 **机器可读 + 可复现** 的清单与评分。

### 1.1 Universe Builder 输出文件（建议）
- `universe_crypto.json`：BTC/ETH/SOL…（市值前100，提出掉稳定币）
- `universe_ashares.json`：上证指数和沪深300 成分股
- `universe_us.json`：道琼斯30，纳斯达克100，S&P500成分股子集
- `coverage_matrix.csv`：每个标的支持哪些分支（hourly/daily、特征源是否可用、是否启用）
- `ranked_universe.csv`：按综合评分排序（决定先做哪些）
- `data_quality_report.md`：缺失率、重复率、异常跳点、最新更新时间

---

## 2. “硬门槛”（Hard Filters）：不满足直接淘汰

机构通常先做硬过滤，避免把时间浪费在“必炸标的”上。

### 2.1 通用硬门槛（所有市场）
- **历史长度**：日线 ≥ 2 年；小时线 ≥ 6–12 个月（样本不足直接淘汰）
- **数据缺失率**：缺失 < X%（建议先用 1%–5%）
- **可交易性/流动性**：均量/成交额 ≥ 阈值（避免滑点巨大、噪声极端）
- **可对齐性**：有明确交易日历/交易时段规则（股票尤为重要）

### 2.2 Crypto 硬门槛（建议）
- 排除稳定币、极度缺流动性小币
- 优先选择在你数据源交易所（ccxt/binance/bybit）**数据稳定**的标的
- 若未来加衍生品特征（funding/OI/basis），标的需有稳定 perp 市场（BTC/ETH 通常满足）

### 2.3 A股 硬门槛（建议）
- 从指数成分开始（CSI300）
- 排除 ST、长期停牌、上市太短、频繁异常停牌

### 2.4 美股 硬门槛（建议）
- 从大盘成分开始（道琼斯30，纳斯达克100，S&P500成分股子集）
- 日线优先；小时线后做（小时线复权/DST 更容易踩坑）

---

## 3. “软评分”（Soft Scoring）：决定你先做哪一批

硬门槛通过后，用评分决定优先级。输出一个综合分 `Score ∈ [0,100]`，并按分数排序。

### 3.1 建议评分构成
- **LiquidityScore（0–30）**：成交额、点差（若可获取）
- **DataQualityScore（0–30）**：缺失率、异常跳点、重复 timestamp
- **HistoryScore（0–20）**：上市/交易历史长度
- **CoverageScore（0–20）**：是否支持关键特征（衍生品/复权/交易时段等）

### 3.2 输出与使用方式
- 输出 `ranked_universe.csv`
- 实际建模只做 Top N：
  - Crypto：Top100（剔除稳定币）+ Top3（BTC/ETH/SOL，核心必选）
  - A股：上证指数，沪深300
  - 美股：道琼斯30，纳斯达克100，S&P500成分股子集

---

## 4. Universe 分层（Tiering）：控制范围、防止爆炸

机构常见做法：把标的池分层，保证项目可交付。

- **Tier-0（演示必跑）**：BTC/ETH/SOL + A股 30–50 + 美股 30–50  
- **Tier-1（扩展）**：Crypto Top 20 + A股 200 + 美股 200  
- **Tier-2（长期）**：更大池/更多特征（期权、链上、新闻情绪等）

---

## 5. 调研（Research）怎么做：把研究变成可复现流水线

机构量化更像工程：不断迭代一个研究闭环。

### 5.1 研究闭环（Research Loop）
1. **提出假设**：哪些信息可能预测收益/波动（动量、波动聚集、成交量冲击、结构指标等）
2. **定义数据与对齐**：时区、交易时段、复权、缺失处理
3. **定义标签**：方向/启动窗口/区间（你的三任务）
4. **训练与验证**：walk-forward + gap/purge（防泄露）
5. **稳健性测试**：不同阈值、不同阶段、不同市场状态、交易成本
6. **影子跟踪**：paper trading / shadow mode（可选）
7. **上线后监控**：漂移、衰减、再训练触发

### 5.2 实验产物标准化（Research Artifacts）
每次实验自动生成：
- `leaderboard.csv`：baseline/MVP/advanced 对比
- `metrics.csv`：市场×标的×时间尺度×horizon×fold 的详细指标
- `prediction_samples.csv`：抽样预测用于展示与 case study
- `weekly_report.md`：数据健康 + 指标汇总 + 典型案例

---

## 6. 跟踪（Tracking / Monitoring）：监控“三类健康”

### 6.1 数据健康（Data Health）
自动产出 `data_quality_report`：
- 缺失率、重复率、异常跳点（returns 极端值）
- 最新更新时间戳（是否断更）
- 交易日历对齐：
  - Crypto 24/7 连续
  - A股午休不生成假 K 线
  - 美股 DST 正确（存 UTC，展示美东）

### 6.2 模型健康（Model Health）
按你的输出三件套监控：
- **方向**：AUC/F1 的 rolling 指标 + 概率质量（Brier）
- **启动窗口**：Top-1/Top-2 命中率趋势
- **区间预测**：Coverage 是否偏离目标（例如 80% 区间是否显著低于 0.8）

### 6.3 策略/可用性健康（可选但加分）
轻量回测（paper trading）：
- 阈值信号：P(up)>0.55 做多；P(up)<0.45 做空；否则空仓
- 成本：手续费 + 滑点 + 延迟（t 信号、t+1 执行）
- 输出：收益、回撤、Sharpe、与 baseline 对比

---

## 7. 机构/投行量化团队通常怎么做（公开可验证的通用框架）

> 机构系统一般拆成多层：Alpha（信号）只是第一层。

### 7.1 Alpha（预测/信号）
- 因子模型、统计模型、机器学习模型 → 产生预测信号/概率/区间

### 7.2 风险模型（Risk Model）
- 多因子风险模型（行业、风格、协方差）用于控制组合风险
- 项目不必完整实现，但可在“未来扩展”写入：引入风险约束与归因分析

### 7.3 交易成本与执行（TCA / Execution）
- 机构会建成本模型（滑点/冲击），并用执行策略降低实现偏差
- 你的项目用“固定 bps 成本 + 延迟”的简化版即可体现理解

### 7.4 可复现与治理（ModelOps/MLOps）
- 强调数据/特征/模型版本可追溯
- 训练参数、指标、产物、git hash 全记录
- 可选：MLflow model registry（加分项）

---

## 8. 你项目的落地实施蓝图（推荐版本）

### Phase A：Universe Builder（第 1 周就能出成果）
1) 拉候选池：
- Crypto：Top N（先 BTC/ETH/SOL）
- A股：CSI300 成分（先抽 50）
- 美股：S&P500 子集（先抽 50）

2) 对每个标的计算：
- history length、缺失率、重复率、异常比例
- 流动性 proxy（成交额/成交量）
- 交易时段覆盖（A股午休，美股 DST）

3) 输出：
- `ranked_universe.csv`
- `coverage_matrix.csv`
- `data_quality_report.md`

### Phase B：标准化研究模板（第 2–3 周）
对每个市场套用同一模板：
- Baseline（naive + logistic）
- MVP（LightGBM + Quantile LightGBM）
- Walk-forward + gap/purge
- 产出 leaderboard + metrics

### Phase C：上线跟踪与报表（第 4–6 周）
- 每日/每周自动生成：
  - 数据质量报告
  - 模型指标趋势
  - 预测样本（dashboard 展示）
- 时间允许：加轻量回测 + 2–3 个 case studies

---

## 9. 建议写进文档的“现实承诺”（保证交付）
- **MVP 必做**：Universe Builder + 日线（Crypto/A股/美股）+ Crypto 小时线（BTC/ETH/SOL）
- **加分项**：A股/美股小时线、TFT（仅 daily 对比）、轻量回测、MLflow

---

## 10. 选币/选股执行规则（Action Layer）

下面这部分把“研究结果”变成“可执行动作”，避免只看图不落地。

### 10.1 入选阈值表（Signal -> Candidate）

| 维度 | 指标 | 入选阈值（建议初版） | 不满足处理 |
|---|---|---|---|
| 预测信号 | `P(up)` | `>= 0.55` | 降级为 `Watch` |
| 预测幅度 | `predicted_change_pct` | `> 0`（做多场景） | 不开仓，仅观察 |
| 区间质量 | `q50 - q10`、`q90 - q50` | 不能极端偏斜（防止不稳定预测） | 标记高不确定性 |
| 因子一致性 | 动能/成长/价值方向 | 至少 2 个支持当前方向 | 若冲突则降低权重 |
| 数据质量 | 缺失率 / 断更 | 缺失率 < 3%，最新时间戳在容忍窗口内 | 直接剔除 |
| 流动性 | 成交额/成交量 | 达到市场最低门槛 | 直接剔除 |

备注：
- Crypto 使用 `Top100(剔除稳定币)` 作为候选全集，`Top3` 作为必跟踪核心。
- A股、美股同样按上面阈值执行，保证跨市场一致。

### 10.2 监控告警 -> 动作表（Monitoring -> Action）

| 触发条件 | 连续期 | 动作 | 状态变化 |
|---|---|---|---|
| `P(up) < 0.52` | 2 个观察周期 | 减仓/降权 30%-50% | `Active -> Watch` |
| `predicted_change_pct <= 0` | 2 个观察周期 | 停止新增仓位 | `Active -> Watch` |
| 区间覆盖率 `Coverage < 0.70` | 2 周 | 触发重训 + 回看特征 | `Active -> Watch` |
| Brier / AUC 明显恶化 | 2 周 | 回滚到上个稳定模型版本 | `Active -> Watch` |
| 数据断更或质量异常 | 当日 | 暂停该标的信号 | `Any -> Watch` |
| 风险事件（停牌/重大黑天鹅） | 立即 | 强制退出候选池 | `Any -> Retired` |

### 10.3 状态机（Lifecycle）

| 状态 | 含义 | 进入条件 | 退出条件 |
|---|---|---|---|
| `Candidate` | 候选观察 | 通过硬门槛与软评分 | 连续满足信号阈值进入 `Active` |
| `Active` | 可执行 | 信号稳定 + 数据健康 + 风险可控 | 指标恶化进入 `Watch` |
| `Watch` | 重点观察 | 信号或数据质量变差 | 恢复则回 `Active`，持续恶化进 `Retired` |
| `Retired` | 暂停使用 | 失效/流动性问题/结构性变化 | 重新评估后可回 `Candidate` |

建议节奏（固定化）：
- 日更：信号与数据健康检查；
- 周更：状态迁移（`Candidate/Active/Watch/Retired`）；
- 月更：模型复审与阈值重估（避免长期漂移）。

---
